<nb-layout>
    <nb-layout-column>
        <div class="auth-container">
            <nb-card>
                <nb-card-header>
                    <h1 class="title">Login</h1>
                    <p class="sub-title">Hello! Log in with your email</p>
                </nb-card-header>
                <nb-card-body>
                    @if (errors.length > 0) {
                        <nb-alert status="danger" closable (close)="errors = []">
                            @for (error of errors; track $index) {
                                <div>{{ error }}</div>
                            }
                        </nb-alert>
                    }

                    @if (messages.length > 0) {
                        <nb-alert status="success" closable (close)="messages = []">
                            @for (message of messages; track $index) {
                                <div>{{ message }}</div>
                            }
                        </nb-alert>
                    }

                    <form [formGroup]="loginForm" (ngSubmit)="onSubmit()">
                        <div class="form-control-group">
                            <label class="label" for="input-email">Email address:</label>
                            <input
                                nbInput
                                fullWidth
                                formControlName="email"
                                id="input-email"
                                type="email"
                                placeholder="Email address"
                                [status]="getInputStatus('email')"
                                [attr.aria-invalid]="f['email'].invalid && (f['email'].dirty || f['email'].touched || submitted)"
                            />
                            @if (f['email'].invalid && (f['email'].dirty || f['email'].touched || submitted)) {
                                <div class="alert-message">
                                    @if (f['email'].errors?.['required']) {
                                        <div>Email is required</div>
                                    }
                                    @if (f['email'].errors?.['email']) {
                                        <div>Email must be valid</div>
                                    }
                                </div>
                            }
                        </div>
                        <div class="form-control-group">
                            <label class="label" for="input-password">Password:</label>
                            <input
                                nbInput
                                fullWidth
                                formControlName="password"
                                id="input-password"
                                [type]="showPassword ? 'text' : 'password'"
                                placeholder="Password"
                                [status]="getInputStatus('password')"
                                [attr.aria-invalid]="f['password'].invalid && (f['password'].dirty || f['password'].touched || submitted)"
                            />
                            <button
                                nbButton
                                ghost
                                type="button"
                                class="toggle-password"
                                (click)="toggleShowPassword()"
                                [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'"
                            >
                                <nb-icon [icon]="showPassword ? 'eye-off-outline' : 'eye-outline'"></nb-icon>
                            </button>
                            @if (f['password'].invalid && (f['password'].dirty || f['password'].touched || submitted)) {
                                <div class="alert-message">
                                    @if (f['password'].errors?.['required']) {
                                        <div>Password is required</div>
                                    }
                                    @if (f['password'].errors?.['minlength']) {
                                        <div>Password must be at least 6 characters</div>
                                    }
                                </div>
                            }
                        </div>

                        <div class="form-control-group accept-group">
                            <nb-checkbox formControlName="rememberMe">Remember me</nb-checkbox>
                        </div>

                        <button
                            nbButton
                            fullWidth
                            type="submit"
                            [disabled]="loading"
                            [class.btn-pulse]="loading"
                        >
                            {{ loading ? 'Loading in...' : 'Log In' }}
                        </button>
                    </form>

                    <section class="another-action" aria-label="Register">
                        Don't have an account <a class="text-link" routerLink="../register">Register</a>
                    </section>
                </nb-card-body>
            </nb-card>
        </div>
    </nb-layout-column>
</nb-layout>